<div class="min-h-screen bg-gray-100 flex justify-center items-start pt-12">
  <div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-xl space-y-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ </h1>

    <% if @schedule_item.errors.any? %>
      <div class="bg-red-100 border border-red-400 text-red-700 p-4 rounded">
        <p><strong>ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™:</strong></p>
        <ul class="list-disc list-inside">
          <% @schedule_item.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%= form_with(model: [@plan, @schedule_item], local: true) do |f| %>
      <div class="space-y-4">
        <!-- æ—¥æ•° -->
        <div>
          <%= f.label :day_number, "ä½•æ—¥ç›®", class: "block text-gray-700 font-medium mb-1" %>
          <%= f.number_field :day_number, min: 1, class: "w-full border-gray-300 rounded-lg shadow-sm" %>
        </div>

        <!-- é–‹å§‹æ™‚é–“ -->
        <div>
          <%= f.label :start_time, "é–‹å§‹æ™‚é–“", class: "block text-gray-700 font-medium mb-1" %>
          <%= f.time_field :start_time, class: "w-full border-gray-300 rounded-lg shadow-sm" %>
        </div>

        <!-- çµ‚äº†æ™‚é–“ -->
        <div>
          <%= f.label :end_time, "çµ‚äº†æ™‚é–“", class: "block text-gray-700 font-medium mb-1" %>
          <%= f.time_field :end_time, class: "w-full border-gray-300 rounded-lg shadow-sm" %>
        </div>

        <!-- å ´æ‰€ -->
        <div class="mb-4">
          <%= f.label :address, "å ´æ‰€ï¼ˆæ–½è¨­åã‚„ä½æ‰€ï¼‰", class: "block text-gray-700 font-medium mb-1" %>
          <%= f.text_field :address, class: "w-full border-gray-300 rounded-lg shadow-sm", id: "address-field" %>
        </div>

        <!-- ãƒãƒƒãƒ— -->
        <div id="map" class="w-full h-64 rounded-lg shadow border"></div>
      </div>

      <div class="flex justify-end pt-6">
        <%= f.submit "ä½œæˆ", class: "bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg" %>
      </div>
    <% end %>

    <div class="pt-4">
      <%= link_to "â† æˆ»ã‚‹", plan_schedule_items_path(@plan), class: "text-blue-500 hover:underline text-sm" %>
    </div>
  </div>
</div>

<%= javascript_include_tag "https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" %>
<%= stylesheet_link_tag "https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" %>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const defaultLat = <%= @schedule_item.latitude || 35.681236 %>;
    const defaultLng = <%= @schedule_item.longitude || 139.767125 %>;

    const map = L.map('map').setView([defaultLat, defaultLng], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãªãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
    const marker = L.marker([defaultLat, defaultLng], { draggable: true }).addTo(map);

    // ãƒãƒ¼ã‚«ãƒ¼ãŒãƒ‰ãƒ©ãƒƒã‚°ã•ã‚ŒãŸå¾Œã®ä½ç½®ã‚’å–å¾—ã—ã¦ hidden ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ä»£å…¥
    marker.on('dragend', function (e) {
      const position = marker.getLatLng();
      document.getElementById('latitude').value = position.lat;
      document.getElementById('longitude').value = position.lng;
    });
  });
</script>
