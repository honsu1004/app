<div class="min-h-screen bg-gray-100 relative px-4 py-8">
  <h1 class="text-3xl font-bold text-gray-800 mb-8"><%= @plan.title %> のスケジュール</h1>

  <% grouped_items = @schedule_items.group_by(&:day_number).sort_by { |day, _| day.to_i }.to_h %>

  <% grouped_items.each do |day, items| %>
    <div class="mb-8">
      <h2 class="text-xl font-semibold text-blue-600 mb-4">📅 <%= day %>日目</h2>

      <div class="space-y-4">
        <% items.sort_by { |item| item.start_time || Time.parse("23:59") }.each do |item| %>
          <div class="bg-white rounded-xl shadow p-4 flex flex-col sm:flex-row justify-between items-start sm:items-center">
            <div>
              <!-- 場所名（URLがある場合はクリック可能、URLは表示しない） -->
              <% if item.url.present? %>
                <p class="text-gray-800 font-semibold">
                  📍 <%= link_to item.location_name, item.url, 
                          target: "_blank", 
                          rel: "noopener noreferrer", 
                          class: "text-blue-600 hover:text-blue-800 hover:underline" %>
                </p>
              <% else %>
                <p class="text-gray-800 font-semibold">📍 <%= item.location_name %></p>
              <% end %>
              
              <!-- 時間表示 -->
              <% if item.start_time.present? %>
                <p class="text-sm text-gray-600 mt-1">
                  🕒 <%= item.start_time.strftime("%H:%M") %>
                  <% if item.end_time.present? %>
                    〜<%= item.end_time.strftime("%H:%M") %>
                  <% end %>
                </p>
              <% else %>
                <p class="text-sm text-gray-600 mt-1">🕒 時間未設定</p>
              <% end %>
            </div>
            
            <!-- 編集ボタン -->
            <%= link_to "編集", edit_plan_schedule_item_path(@plan, item), 
                class: "text-sm text-blue-500 hover:underline mt-2 sm:mt-0" %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if grouped_items.empty? %>
    <p class="text-gray-600">スケジュールがまだ登録されていません。</p>
  <% end %>

  <!-- 右下の「＋スケジュール追加」ボタン -->
  <div class="fixed bottom-6 right-6">
    <%= link_to new_plan_schedule_item_path(@plan),
                class: "bg-blue-500 hover:bg-blue-600 text-white text-lg font-bold py-3 px-5 rounded-full shadow-lg" do %>
      ＋ スケジュール追加
    <% end %>
  </div>
  
  <div class="mt-6 text-center">
    <%= link_to "← プランに戻る", plan_path(@plan), class: "text-blue-500 hover:underline" %>
  </div>
</div>
